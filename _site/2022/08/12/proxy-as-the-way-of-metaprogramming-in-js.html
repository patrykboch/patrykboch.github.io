<!DOCTYPE html><html lang="en" ><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y7YWNPD60C"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Y7YWNPD60C'); </script><meta name="generator" content="Jekyll v3.9.0" /><meta property="og:title" content="Proxy as the way of metaprogramming in JS" /><meta name="author" content="Patryk" /><meta property="og:locale" content="en_US" /><meta name="description" content="How to use Proxy es6 object in JS for metaprogramming" /><meta property="og:description" content="How to use Proxy es6 object in JS for metaprogramming" /><link rel="canonical" href="http://localhost:4000/2022/08/12/proxy-as-the-way-of-metaprogramming-in-js" /><meta property="og:url" content="http://localhost:4000/2022/08/12/proxy-as-the-way-of-metaprogramming-in-js" /><meta property="og:site_name" content="boch.dev" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-12T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Proxy as the way of metaprogramming in JS" /><meta name="twitter:site" content="@Boch_Patryk" /><meta name="twitter:creator" content="@patrykboch" /> <script type="application/ld+json"> {"description":"How to use Proxy es6 object in JS for metaprogramming","@type":"BlogPosting","headline":"Proxy as the way of metaprogramming in JS","dateModified":"2022-08-12T00:00:00+02:00","datePublished":"2022-08-12T00:00:00+02:00","url":"http://localhost:4000/2022/08/12/proxy-as-the-way-of-metaprogramming-in-js","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2022/08/12/proxy-as-the-way-of-metaprogramming-in-js"},"author":{"@type":"Person","name":"Patryk"},"@context":"https://schema.org"}</script><title> Proxy as the way of metaprogramming in JS - boch.dev</title><link rel="shortcut icon" href="/favicon.png"><link rel="alternate" type="application/atom+xml" title="boch.dev" href="/atom.xml"><link rel="alternate" type="application/json" title="boch.dev" href="http://localhost:4000/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml" /><style> @import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600&display=swap");*,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui, sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.5;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post{font-family:"Source Sans Pro",sans-serif}.post p{line-height:18pt;margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.gist{margin-top:10px}.meta{margin:2rem 0}code,pre{-webkit-border-radius:5px;-moz-border-radius:5px;border-radius:5px}.logo{color:red}code{font-size:14px;padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none;font-family:"Source Sans Pro",sans-serif}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-family:"Source Sans Pro",sans-serif;font-weight:bold}header,section{padding:1rem}blockquote{border-left:5px solid #ececec;padding-left:1rem;margin:2% 0;font-size:17px}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{font-family:"Source Sans Pro",sans-serif;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{font-family:"Source Sans Pro",sans-serif;font-weight:400;font-size:13px;color:red;padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column;text-align:justify}figcaption{font-size:smaller}.highlight .c,.highlight .cm,.highlight .c1,.highlight .cs{color:#408080}.highlight .k,.highlight .kc,.highlight .kd,.highlight .kn,.highlight .kp,.highlight .kr,.highlight .sx,.highlight .bp,.highlight .nt,.highlight .nb{color:#008000}.highlight .o,.highlight .m,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo,.highlight .il{color:#666666}.highlight .cp{color:#bc7a00}.highlight .gd{color:#a00000}.highlight .gr{color:#ff0000}.highlight .gh,.highlight .gp{color:#000080}.highlight .gi{color:#00a000}.highlight .go{color:#808080}.highlight .gu{color:#800080}.highlight .gt{color:#0040d0}.highlight .kt{color:#b00040}.highlight .na{color:#7d9029}.highlight .no{color:#880000}.highlight .nd,.highlight .ow{color:#aa22ff}.highlight .ni{color:#999999}.highlight .ne{color:#d2413a}.highlight .nc,.highlight .nf,.highlight .nn{color:#0000ff}.highlight .nl{color:#a0a000}.highlight .w{color:#bbbbbb}.highlight .s,.highlight .sb,.highlight .sc,.highlight .sd,.highlight .s2,.highlight .sh,.highlight .s1{color:#ba2121}.highlight .se{color:#bb6622}.highlight .si,.highlight .sr{color:#bb6688}.highlight .ss,.highlight .vs,.highlight .vg,.highlight .vi,.highlight .nv{color:#19177c}.highlight .c,.highlight .cm,.highlight .c1,.highlight .cs,.highlight .ge,.highlight .sd{font-style:italic}.highlight .k,.highlight .kc,.highlight .kd,.highlight .kn,.highlight .kr,.highlight .gh,.highlight .gp,.highlight .gs,.highlight .gu,.highlight .nc,.highlight .ni,.highlight .ne,.highlight .nn,.highlight .nt,.highlight .ow,.highlight .se,.highlight .si{font-weight:bold}</style></head><body><main role="main"><header role="banner"><nav role="navigation"><ul> <img src="https://avatars1.githubusercontent.com/u/42003319?s=460&u=22038b8d46cbc023fbde6b7fc730f6d2ce522826&v=4" style="border-radius: 50%!important;" width="90%"/><li><a href="/" class="logo">boch.dev</a></li><li><a href="/" >Dull posts</a></li><li><a href="/about" >About me</a></li><li><a href="/contact" >Contact info</a></li><li><a href="/atom.xml" >Rss</a></li></ul></nav></header><section class="post"> <span><time datetime="2022-08-12T00:00:00+02:00">August 12, 2022</time> &middot; <a href="/tag/js">js</a>, <a href="/tag/proxy">proxy</a>, <a href="/tag/metaprogramming">metaprogramming</a>, <a href="/tag/reflect">reflect</a> </span><h2>Proxy as the way of metaprogramming in JS</h2><p>Important note: Described <em>Proxy</em> object is something different than one of the OOP patterns.</p><p>I’ve seen several odd JS characteristics ever since I started using it on a daily basis. One of these irritates me — <code class="language-plaintext highlighter-rouge">undefined</code> rather than a code execution error when attempting to access properties that don’t exist. In this regard, JS behaves somewhat differently from my experience with Ruby:</p><script src="https://gist.github.com/patrykboch/48bf5dd1f626c2c889c8bfa43931dd51.js"></script><p>and a Ruby equivalent:</p><script src="https://gist.github.com/patrykboch/c29bb0a5faacee9c1548c23eb4eff44b.js"></script><p>The error throw is produced by Ruby, but JS returns <code class="language-plaintext highlighter-rouge">undefined</code>. Imagine working on a large JS project and a simple property typo results in an app being broken because <code class="language-plaintext highlighter-rouge">undefined</code> was used instead of the <em>key not found</em> throw. You would not know why or where this happened because <code class="language-plaintext highlighter-rouge">undefined</code> may appear throughout many different places (debugging undefined may take a long time). Fortunately, the built-in Proxies objects provided by the ES6+ standard provide a solution to the concern.</p><p>Since the release of ES6, JS is known as fully reflective programming language as the <em>Reflection API</em> has been advanced.</p><blockquote><p>Reflection is the ability of a computer program to examine, introspect, and modify its own structure and behavior at runtime.</p></blockquote><p>That implies that a program can execute on each of the three levels mentioned. Please be aware that ES5 has provided the potential of reflective introspection and self-modification - <code class="language-plaintext highlighter-rouge">Object.keys()</code> for introspection or <code class="language-plaintext highlighter-rouge">Object#delete</code> for self-modification - also all <code class="language-plaintext highlighter-rouge">Object.*</code> methods are taken as reflective for metaprogramming, but neither they nor other ES5 features support the third level of reflection - <em>behavioral level</em> which is the reason for the introduction of proxies in ES6 that alter built-in language operations.</p><blockquote><p>The Proxy object is used to define custom behavior for fundamental operations (e.g. property lookup, assignment, enumeration, function invocation, etc). <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Meta_programming">(official docs)</a></p></blockquote><p>Using proxies is a way for virtualizing objects eg. POJOs. Virtualized object peeks the same as a given object, and any operation on a given one directs to an already created virtualized by a proxy object. By virtualization, we can take control of standard methods default behavior by intercepting invocations and re-defining them.</p><script src="https://gist.github.com/patrykboch/cf189feaad1e574d01194ff9d9a04a31.js"></script><p>Nothing special above, virtualization of the object and the property lookup without invoking any operations (see: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy#No-op_forwarding_proxy">no-op forwarding</a>). When you add a property to an object, the same property is added to the proxy object. Although it is a symlink, proxies are designed to intercept low-level operations on the target object.</p><h2 id="error-instead-of-undefined">Error instead of undefined</h2><p><em>…when accessing non-existent property with the <code class="language-plaintext highlighter-rouge">get</code> trap.</em></p><p>Let’s solve the issue that is raised at the beginning of the post. How can the default behavior, which terminates in <code class="language-plaintext highlighter-rouge">undefined</code> be changed to an error caused by code execution like in Ruby or Python? Let’s start by describing the default behavior using a proxy object:</p><script src="https://gist.github.com/patrykboch/d069e35aaf76b55c5f75ffe6a35eef34.js"></script><p>Let’s change the default behaviour:</p><script src="https://gist.github.com/patrykboch/3e2608d8ba474e311066d7bafe06127e.js"></script><p>I passed the trap the following three arguments: 1) the target object for the proxy is denoted the <code class="language-plaintext highlighter-rouge">trapTarget</code> 2) the <code class="language-plaintext highlighter-rouge">key</code> - the property and 3) the <code class="language-plaintext highlighter-rouge">receiver</code> - the proxy reference. The js object <code class="language-plaintext highlighter-rouge">Reflect</code>, which describes the default behavior of js. Please note there is a <code class="language-plaintext highlighter-rouge">Reflect</code> technique for each proxy trap.</p><p>To recap, operations can be intercepted using a handler and a proxy trap, which is a function that is always supplied as the second proxy argument and is in charge of the operation. <br /> <br /></p><center><div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;lightbox&quot;:false,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile modified=\&quot;2019-04-28T10:57:51.851Z\&quot; host=\&quot;www.draw.io\&quot; agent=\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36\&quot; etag=\&quot;KT1R89YZZIPHrD0EufzU\&quot; version=\&quot;10.6.5\&quot; type=\&quot;device\&quot;&gt;&lt;diagram id=\&quot;lh_yR_ml-EyFlSGjHwGa\&quot; name=\&quot;Page-1\&quot;&gt;3VnfU+IwEP5rmLl70GmbttBHFfUevNE7nbnTt0BDG680TAhC/esvoUl/JMWCUnR4orvdbpJv90t2Qw9cTFfXFM7inyRESc+xwlUPDHuOY7vBgP8ITZZrAiEJRURxKI1KxT1+RVJpSe0Ch2heM2SEJAzP6soxSVM0ZjUdpJQs62YTktRHncEIGYr7MUxM7R8csjjXDjyr1P9AOIrVyLYl30yhMpaKeQxDsqyowGUPXFBCWP40XV2gRICncMm/u9rwtpgYRSnb5oMgunGePHobXi+sx+df/5wna3Di515eYLKQC76dIQoZJqmcNcsUFMsYM3Q/g2MhL3m4e+A8ZtOESzZ/lJ4QZWi1cYp2sXCeMYhMEaMZN5EfOArWTKWPlJcl9AXAcQV2ZQdltKPCdQkIf5CY7IBP38DnN5ovEvYJ4HiDrwbOwADHgAWFnE1SRMmILC9LxflawV8IWDCnXB0yShZpiMT4VgGgcPc2fHx0sqBj1J7zDNIIsbbYm+GgKOH8eKnPownb9adnlMKsYjAjOGXziuc7oSijDFwtyr7Gas3e7TdnRRnXfAZllIulvD/wanM+SOR5fGn2VwinwFHyI5dPrFPLU4rhqmo+zKrSHaKYLxlRpVxhljt0PCk+yqHFc+lKCFlHCfjRxDIyoTgyVSYMNN7n85JfvZVSrlNz5PiDuqOcOYajXVPd1SZsHGA6NbQNUC144zp0/1aLf78ZwG3no1G1I+rZh6ReQRTfrTJFMK+gTjNdhGDwrmSyVyWy3ULi7al3mD29YRP2NMYE76OerxdAOof3RD29lmijnuftRj2gn0pBi32g2fcPQSXXoNKUhHjCWdFY//LSjWlsQXP8CkdrA5GoEnZu7Z33vCHXwAUj87ypER/ABEcpf07QRLhSHDyTakZE2TjnVSROowchDE/c/VSPrlNPUeCY1WPQUDw6XRWPtllah2gC17W1NUIxfMGE9sTwV2uCThLe3q3D4icCuxF/6UdsjY6pOabQGeQADYW/3xA70FnszMqfo4f4Fjc7PuboZYHTAP+gAX27M/QDA/35DI3FxiWoAxV1jikIntUehMbmt7MoALMQexBt/+EvBow6t78lNp1dDADzZL2jZJV9+35cWVlkYaahXEHeO2hSmoeqgXi1OyCUxSQiKUyqLUK9CShtbsgaPYH5M2Isk7e1IhxNSb2XXhnIsqW1st9LU71rHe1odXRLmfu2eTdVrgKwesU7ehZX5YffqfT73U+/wVQ3HZ/Ml7LP7m9/IVXppvu1drpsoD/aTn8xdpp8Chr5tHPbrfuxPc3RntpuoDVhqpLf2Ba/bd/NhuECgxMxTMMEHVlJaQQ98IzdqKmresfhzcXyf748TuW/peDyPw==&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}"></div><script type="text/javascript" src="https://www.draw.io/js/viewer.min.js"></script></center><p><br /> <br /></p><p>I’ve shown two branches on the diagram: the default behavior and the proxy’s interception of the default behavior. On the most fundamental level, default reflection yields <code class="language-plaintext highlighter-rouge">undefined</code>. The same outcome is also possible with a proxy.</p><p>The second branch - <code class="language-plaintext highlighter-rouge">Proxy</code> intercepts default behaviour by get trap in the handler and raises an error in the code example if property doesn’t exist. Note: <code class="language-plaintext highlighter-rouge">get</code> trap is one of many others traps - <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy#Methods_of_the_handler_object">see all available traps for the <code class="language-plaintext highlighter-rouge">Proxy</code></a>.</p><h2 id="building-two-way-data-binding-using-proxy">Building two-way data binding using <em>Proxy</em></h2><p>Moving on let’s dive into a more complex thing. If you’re familiar with AngularJS or VueJS you’re probably into two-way data binding concept as it’s the main philosophy of these frameworks (see <a href="https://docs.angularjs.org/guide/databinding">AngularJS</a> docs or <a href="https://vuejs.org/v2/guide/forms.html">VueJs example of <em>v-model</em></a>)</p><blockquote><p>Two-way-data binding links the state with the view. If the state changes the view is updated and if the view changes the state will be updated.</p></blockquote><p>Using Proxy is the way to go if you want to create your own two-way data binding-based js framework. Our view can be connected to application state through a proxy. Consider the following illustration: <script src="https://gist.github.com/patrykboch/3d7b1627643facc4cbdf0ba273d4a877.js"></script> <script src="https://gist.github.com/patrykboch/13f5bd92ce082e698aabe2f90032e173.js"></script> <a href="https://jsfiddle.net/edzv5L0q/">see live example</a></p><p>The state and the view are now bound. The view alters as the state does. First, I gave the DOM input elements a brand-new attribute called <code class="language-plaintext highlighter-rouge">data-model</code>. The key component of two-way data binding is the model, which connects input value and app state. After that, I created the straightforward state interface with two keys (name and hobby). It’s good to note that only keys that have been set in the interface can be modified in a proxy; otherwise, an error will be raised if eg. <code class="language-plaintext highlighter-rouge">state.strangerKey = "Hello"</code>. The next step is to build a proxy that has a <code class="language-plaintext highlighter-rouge">set</code> trap in the handler; <code class="language-plaintext highlighter-rouge">updateView</code> is added between calls to the default engine set behavior, which means that each time the state is attempted to be changed, the input values in the view will also be altered. From a view to a state direction. Also listeners have been provided to the view that detect input value changes and trigger the state change. So registering listeners on DOM elements is crucial because only registered listeners can change the state via the <code class="language-plaintext highlighter-rouge">onInputChange</code> event handler.</p><p>For now, the journey with Proxy wound up, I’ve presented the most common proxy traps - <code class="language-plaintext highlighter-rouge">get</code> and <code class="language-plaintext highlighter-rouge">set</code> but keep in mind that Proxy supports twelve more handlers which can be used for different purposes, especially in metaprogramming.</p><p>PS. Metaprogramming rocks :). <br /></p></section></main></body></html>
